FIND_PACKAGE(OpenMP)

if(OPENMP_FOUND)
 set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${OpenMP_C_FLAGS}")
 set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS} -D_PWN_USE_OPENMP_ -DEIGEN_DONT_PARALLELIZE")
 set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} ${OpenMP_EXE_LINKER_FLAGS}")
endif(OPENMP_FOUND)

INCLUDE_DIRECTORIES(${EIGEN_INCLUDE_DIR} ${QGLVIEWER_INCLUDE_DIR} ${QT_INCLUDES}  ${CSPARSE_INCLUDE_DIR})

ADD_EXECUTABLE(pwn_g2o pwn_g2o.cpp)
SET_TARGET_PROPERTIES(pwn_g2o PROPERTIES OUTPUT_NAME pwn_g2o)
TARGET_LINK_LIBRARIES(pwn_g2o  
  pwn2_library
  sensor_data_library
  ${G2O_CORE_LIBRARY}
  ${G2O_OPENGL_HELPER_LIBRARY}
  ${G2O_TYPES_DATA}
  ${G2O_TYPES_SLAM2D}
  ${G2O_TYPES_SLAM3D}
  ${G2O_STUFF_LIBRARY}
  ${G2O_CORE_LIBRARY}
  ${G2O_SOLVER_CSPARSE}
  ${G2O_STUFF_LIBRARY}
  ${G2O_SOLVER_CSPARSE_EXTENSION}
  ${CSPARSE_LIBRARY}
)

IF(CUDA_FOUND)  
  TARGET_LINK_LIBRARIES(pwn_g2o  pwn_cuda_library ${CUDA_CUDART_LIBRARY})
ENDIF(CUDA_FOUND)


ADD_EXECUTABLE(pwn_g2o_viewer pwn_g2o_viewer.cpp)
SET_TARGET_PROPERTIES(pwn_g2o_viewer PROPERTIES OUTPUT_NAME pwn_g2o_viewer)
TARGET_LINK_LIBRARIES(pwn_g2o_viewer  
  pwn2_library pwn_viewer_library
  pwn_mapper_library
  sensor_data_library
  ${QGLVIEWER_LIBRARY} ${QT_QTXML_LIBRARY} ${QT_QTOPENGL_LIBRARY} ${QT_QTGUI_LIBRARY} ${QT_QTCORE_LIBRARY} 
  ${OPENGL_gl_LIBRARY} ${OPENGL_glu_LIBRARY} 
  ${G2O_CORE_LIBRARY}
  ${G2O_OPENGL_HELPER_LIBRARY}
  ${G2O_TYPES_DATA}
  ${G2O_TYPES_SLAM2D}
  ${G2O_TYPES_SLAM3D}
  ${G2O_STUFF_LIBRARY}
  ${G2O_CORE_LIBRARY}
  ${G2O_SOLVER_CSPARSE}
  ${G2O_STUFF_LIBRARY}
  ${G2O_SOLVER_CSPARSE_EXTENSION}
  ${CSPARSE_LIBRARY}
)

ADD_EXECUTABLE(pwn_g2o_mapper_viewer pwn_g2o_mapper_viewer.cpp)
SET_TARGET_PROPERTIES(pwn_g2o_mapper_viewer PROPERTIES OUTPUT_NAME pwn_g2o_mapper_viewer)
TARGET_LINK_LIBRARIES(pwn_g2o_mapper_viewer  
  pwn2_library pwn_viewer_library
  pwn_mapper_library
  sensor_data_library
  ${QGLVIEWER_LIBRARY} ${QT_QTXML_LIBRARY} ${QT_QTOPENGL_LIBRARY} ${QT_QTGUI_LIBRARY} ${QT_QTCORE_LIBRARY} 
  ${OPENGL_gl_LIBRARY} ${OPENGL_glu_LIBRARY} 
  ${G2O_CORE_LIBRARY}
  ${G2O_OPENGL_HELPER_LIBRARY}
  ${G2O_TYPES_DATA}
  ${G2O_TYPES_SLAM2D}
  ${G2O_TYPES_SLAM3D}
  ${G2O_STUFF_LIBRARY}
  ${G2O_CORE_LIBRARY}
  ${G2O_SOLVER_CSPARSE}
  ${G2O_STUFF_LIBRARY}
  ${G2O_SOLVER_CSPARSE_EXTENSION}
  ${CSPARSE_LIBRARY}
)

ADD_EXECUTABLE(pwn_g2o_loop_closer pwn_g2o_loop_closer.cpp)
SET_TARGET_PROPERTIES(pwn_g2o_loop_closer PROPERTIES OUTPUT_NAME pwn_g2o_loop_closer)
TARGET_LINK_LIBRARIES(pwn_g2o_loop_closer  
  pwn2_library pwn_viewer_library
  pwn_mapper_library
  sensor_data_library
  ${QGLVIEWER_LIBRARY} ${QT_QTXML_LIBRARY} ${QT_QTOPENGL_LIBRARY} ${QT_QTGUI_LIBRARY} ${QT_QTCORE_LIBRARY} 
  ${OPENGL_gl_LIBRARY} ${OPENGL_glu_LIBRARY} 
  ${G2O_CORE_LIBRARY}
  ${G2O_OPENGL_HELPER_LIBRARY}
  ${G2O_TYPES_DATA}
  ${G2O_TYPES_SLAM2D}
  ${G2O_TYPES_SLAM3D}
  ${G2O_STUFF_LIBRARY}
  ${G2O_CORE_LIBRARY}
  ${G2O_SOLVER_CSPARSE}
  ${G2O_STUFF_LIBRARY}
  ${G2O_SOLVER_CSPARSE_EXTENSION}
  ${CSPARSE_LIBRARY}
)

ADD_EXECUTABLE(pwn_g2o_follower pwn_g2o_follower.cpp)
SET_TARGET_PROPERTIES(pwn_g2o_follower PROPERTIES OUTPUT_NAME pwn_g2o_follower)
TARGET_LINK_LIBRARIES(pwn_g2o_follower  
  pwn2_library pwn_viewer_library
  pwn_mapper_library
  sensor_data_library
  ${QGLVIEWER_LIBRARY} ${QT_QTXML_LIBRARY} ${QT_QTOPENGL_LIBRARY} ${QT_QTGUI_LIBRARY} ${QT_QTCORE_LIBRARY} 
  ${OPENGL_gl_LIBRARY} ${OPENGL_glu_LIBRARY} 
  ${G2O_CORE_LIBRARY}
  ${G2O_OPENGL_HELPER_LIBRARY}
  ${G2O_TYPES_DATA}
  ${G2O_TYPES_SLAM2D}
  ${G2O_TYPES_SLAM3D}
  ${G2O_STUFF_LIBRARY}
  ${G2O_CORE_LIBRARY}
  ${G2O_SOLVER_CSPARSE}
  ${G2O_STUFF_LIBRARY}
  ${G2O_SOLVER_CSPARSE_EXTENSION}
  ${CSPARSE_LIBRARY}
)